# Пример использования авторизации с помощью учетных данных клиента в Python #

Это грубый пример, в котором показано, как реализовать поток учетных данных OAuth2 в приложении Python/Django. Приложение позволяет администратору входить в систему и давать разрешения, а пользователям просматривать первые 10 сообщений в папке "Входящие" любого пользователя организации.

## Необходимое программное обеспечение ##

- [Python 3.4.2](https://www.python.org/downloads/)
- [Django 1.7.1](https://docs.djangoproject.com/en/1.7/intro/install/)
- [Запросы: HTTP for Humans](http://docs.python-requests.org/en/latest/)
- [Python-RSA](http://stuvel.eu/rsa)

## Запуск приложения ##

Предполагается, что вы установили Python и Django перед началом. Пользователям Windows следует добавить каталог установки и подкаталог сценариев Python в переменную среду PATH.

1. Скачайте проект приложения или создайте вилку.
1. Откройте командную строку или оболочку в каталоге, в котором находится `manage.py`.
1. Если возможно запускать файлы BAT, запустите setup\_project. bat. Если нет, запустите три команды в файле вручную. Последняя команда предложит вам создать суперпользователь, для входа в систему позже.
1. Установите библиотеку Requests: HTTP for Humans из командной строки: `pip install requests`
1. Установите Python-RSA из командной строки: `pip install rsa`
1. [Зарегистрируйте приложение в Azure Active Directory](https://github.com/jasonjoh/office365-azure-guides/blob/master/RegisterAnAppInAzure.md). Зарегистрируйте приложение как веб-приложение с URL-адресом входа "http://127.0.0.1:8000/", и предоставьте ему разрешение "Чтение почты во всех почтовых ящиках организации", которое доступно в раскрывающемся списке "Разрешения приложений".
1. Настройте сертификат X509 для своего приложения, следуя указаниям [здесь](https://blogs.msdn.microsoft.com/exchangedev/2015/01/21/building-daemon-or-service-apps-with-office-365-mail-calendar-and-contacts-apis-oauth2-client-credential-flow/).
    > Если вы используете OpenSSL, следуйте [этим инструкциям](https://gist.github.com/carlopires/de085999dc69a13efe60). (Спасибо Карло!)
1. Извлеките закрытый ключ в формате RSA из сертификата и сохраните его в файл PEM. (Сделано с помощью OpenSSL.)
`openssl pkcs12 -in <path to PFX file> -nodes -nocerts -passin pass:<cert password> | openssl rsa -out appcert.pem`
1. Измените файл `.\clientcreds\clientreg.py`. 
	1. Скопируйте идентификатор клиента, полученный при регистрации приложения, и вставьте его в качестве значения переменной `id`. 
	1. Укажите полный путь к файлу PEM, который содержит закрытый ключ RSA, в качестве значения переменной `cert_file_path`.
	1. Скопируйте значение отпечатка вашего сертификата (значение, которое используется для `customKeyIdentifier` в манифесте приложения) и вставьте его в качестве значения переменной`cert_file_thumbprint`.
	1. Сохраните файл.
1. Запустите сервер разработки: `python manage.py runserver`
1. Вы увидите:
`Выполнение системных проверок...`
    
    `Проверка системы не обнаружила ошибок (0).`
	`18 декабря 2014 г. 12:36:32`
	`Django версии 1.7.1 используя параметры 'pythoncontacts.settings'`
	`Запуск сервера разработки на http://127.0.0.1:8000/`
	`Выход сервера с помощью CTRL + BREAK.`
1. Используйте браузер, чтобы перейти на страницу http://127.0.0.1:8000/.
1. Вам предложат выполнить вход с помощью учетной записи администратора. Щелкните эту ссылку, чтобы войти с помощью учетной записи администратора Office 365.
2. Вас перенаправит на страницу почты. Введите действительный адрес электронной почты пользователя в клиенте Office 365 и нажмите "Задать пользователя". Последние 10 сообщений для пользователя отобразятся на странице.

## Авторские права ##

(c) Корпорация Майкрософт (Microsoft Corporation). Все права защищены.

----------
Работайте со мной на сайте Twitter [@JasonJohMSFT](https://twitter.com/JasonJohMSFT)

Следуйте инструкциям в [блоге разработчиков Exchange](http://blogs.msdn.com/b/exchangedev/)
